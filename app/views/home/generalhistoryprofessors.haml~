%link(rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css")

%h3{:style=>"text-align:center"} Top Professor Overall
%ul{:style=>"text-align:center"}

%table{:class => "table"}
  %thead
    %tr
      %th= link_to 'Professor', generalhistoryprofessors_path(:sort => 'name')
      %th= link_to 'Wins', generalhistoryprofessors_path(:sort => 'wins')
      %th= link_to 'Appearances', generalhistoryprofessors_path(:sort => 'appearances')
      %th= link_to 'Win Percentage(%)',generalhistoryprofessors_path(:sort => 'winpercentage')
  %tbody
    - @top5.each do |prof|
      %tr
        %td= link_to "#{prof.last_name}, #{prof.first_name} ", "professors/#{prof.id}"
        %td= prof.wins
        %td= prof.appearances
        %td= number_with_precision(prof.winpercentage, :precision => 2)

%div{:style=>"text-align:center"}
  - Pquestion.all.each do |x|
    - y = Professor.find_by_sql('SELECT * from professors INNER JOIN pvotes ON pvotes.professor_id = professors.id WHERE pvotes.pquestion_id ='+x.id.to_s)
    - if not y == []
      %div{:style=>"text-align:center; border: 1px solid black;width:500px;display:inline-block;margin-top:5px;height:200px;"}
        %h4= "#{x.question}"
        %table{:class => "table", :style=>"width:500px;"}
          %thead
            %tr
              %th{:style=>"text-align:center"} Professor Name
              %th{:style=>"text-align:center"} Wins
              %th{:style=>"text-align:center"} Appearances
              %th{:style=>"text-align:center"} Win Percentage (%)
          - y.each do |z|	
            %tbody
              %tr
                %td{:style=>"text-align:center"}= "#{z.first_name} #{z.last_name}"
                %td{:style=>"text-align:center"}= Pvote.where(:professor_id=>z.id, :pquestion_id=>x.id)[0].wins
                %td{:style=>"text-align:center"}= Pvote.where(:professor_id=>z.id, :pquestion_id=>x.id)[0].appearances
                %td{:style=>"text-align:center"}= number_with_precision((Pvote.where(:professor_id=>z.id, :pquestion_id=>x.id)[0].appearances != 0 ? Pvote.where(:professor_id=>z.id, :pquestion_id=>x.id)[0].wins.to_f/Pvote.where(:professor_id=>z.id, :pquestion_id=>x.id)[0].appearances.to_f*100 : 0),:precision=>2)
